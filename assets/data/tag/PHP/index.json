{"hash":"71234bff9790e8006c79e71520ea879d6f16b79e","data":{"tag":{"title":"PHP","belongsTo":{"edges":[{"node":{"title":"Artalk 自托管评论系统的后端部署","path":"/posts/artalk-api-php/","cover_image":{"type":"image","mimeType":"image/png","src":"/assets/static/artalk-api-php.a209973.62a5c1490fd9584deccfb457cc6a6749.png","size":{"width":1280,"height":400},"sizes":"(max-width: 1280px) 100vw, 1280px","srcset":["/assets/static/artalk-api-php.a67b0b2.62a5c1490fd9584deccfb457cc6a6749.png 480w","/assets/static/artalk-api-php.a209973.62a5c1490fd9584deccfb457cc6a6749.png 1280w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1280 400' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-5a9b2862efa77773eeb0150175794da9'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-5a9b2862efa77773eeb0150175794da9)' width='1280' height='400' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAUCAIAAACyFKxoAAAACXBIWXMAABJ0AAASdAHeZh94AAAF8klEQVRIx8VXW1NTVxTmrX%2biD52%2btQ/a6UPrZfrQGUenHe3FcVoRbaugHQdELRAIF2uRFnUEFEERQggBlGsCJCH3s89ln33uAUQUBQft5aHVaXVE246a3XUSoA8FArRTZ1bO7HX2Sc631l7f%2blbSWFFKGifKSVvCZbGEFU2NjfBE5rC09MP/j5vGkmWjFyVR0boHfBXVdRFW4CXlhaNPBLDocxJL5IT7d6Z5WbcU5p/I2lRTU4XVGIfFVbwS4dkzh/Pk8OwuwsR8YOWnmrZYsjlAjwlPVCxriS0ZyibMK%2bVl%2bWO2LEtxMUu0AGdwJpqVvZJoBk8ULKmioguyCi%2bCK6zhjiCp8GscUXi4YplNVRFgaQtvEBkJIlZifkbq9TIAHfE8EjAriIdyc7/YufWotdgbNXr6sCAtm0LJZBPZ5nCGER%2bIoK4%2bty8YAVLBoqWto7uv3xsIA2ioT4YXuWWgNwNYgMQAFxOiGPrEvcaK3I5L1cat3%2bThaWnsp59vGtVl2S%2b9/PqHH7x3I9I%2bzHsZonIraQCD/uC2jz4%2bfqIiz1JYUGQ9W3fhaF5%2bYXFJTW19UUnpkbx8OPB%2brx9iYQQRDmcZJP7HBmfmG6ujUzNPqTc4LGrTfzyn9x4%2bn3lG6a8Tw/zAaxs2p6fvmGAuI6KmzP3cTYkRCQTgHvTVNzSePFPV3tndN%2bCxtbSe%2bK6ysdlhd7Y32Ozn6i9CdYmqPjAUCCMO1olCklZGYhYrooTb/dO1Hnp6IH6wkR6oj1d0xc96aKnzqc3O7y/s2J4X9CKVlyCvKdCLROWxjIkqSxrQFzBJWkzUdChLXtE5VRdjo1g1hAQliGok2RxCnJSgSsouvwCJEZZlBdf33t5xin5le76rKv6Ole6qoiVt8ewmurfqwYbdg69s81TZWVVXkCAthV5UXRzaE7S/6TpZGx0E/kIMJkQw4HEoInl9ZNDD8phN1BibaFBwAmMTt67enBJVI3lnZSQ2A1BxbffkxiKa3UALW2m%2bnVrb6GkXtTppZu3Ttz4Pvbq1N8MaIIrC4kUzhMwAlAKma6fcsTZYtRO1DPG8kEgq9C6k6D/mZD7avH5m09ujjQ2MPsIJJFnAYzcnkTZy8Ur/EDh6DAlkZSRmsKyouKZzcs1h%2bm4phXM4bKPbK%2bl6C11noRsLn23Jjr7xSc%2b6zzyeMBFkedF%2bL0pEVPJQ53bi3Kd2ZbAO33wAAkGqca225veNa%2b7veF/yDSFZ40QzAIAbu3ptiJc9iEAkIJ3skuKQttAGlCx2M5MX/LSTpx6VejXaEqF1PtNamXiGldltDW456D/r4BTdPLEFqxMlCNDDRr%2bMtu9lnHWMV5I00G%2bACCUEyWUU3Wh3Eq%2bPgdIXRLOuhIRhafT6jZHrNwRJYVNJ24JKrDA8Hr429fAxffQk/mAm/vCxad//Ev/hfvzJn/GcSvbA8VBGUejMMmhAiBaOciEeK7IBnTEYRbIxglU9DEhlDQGhjRFIM6gbkFsxhuEKa5TkA07o6SqUGDRLHb3lkumlELVHaHOE2sLUHqVwJvrt%2bLHzfLolsPVQwOUXsSQvQQPYgpRDuwTcIC9nqs81NDU32h1g0Ey7et2lx46fv9jQ2etudjib7I6a2rqmlla7s22ucqTVKHHCJZxkxManh6/fiY3fiSWv43eM8btjE1OnmtDadP%2bekpCJPtU7IACPPwQx%2bMPRsq/LLdbinNwjjvbL5d9WWkuP5Rw%2bkmcpshQVH80v2JuZ9Wn6rn1Z%2b8u%2bKSdz/WdVSjwnPXAOTNJ4AaQN3CiwTxabe6XMfF9LJwxKCsKp5whTj0RTht1eH%2bhXj3sgwvJtV7r6%2bj3w6e33uAa8ME30e4fcHp9r0AsBw3S07HF6ieeIOVZwiTHOBGGazBBN5qN3XeU8xmyypaSeI2aLAWARRYfygB8ELYOQzBlO1mABrBBgkbDESPcfjNOLuKCsPFdQkNfZPzTf45b53Xmpmp2fzXF69g7CyVnadNG/H6dTDvQBJMwOW/iF/ZVZmsQpXC5ZVC/uj9i8%2bxfMRyfaLLKa2QAAAABJRU5ErkJggg==' /%3e%3c/svg%3e"},"date":"August 23. 2020","timeToRead":1,"cjkWordCount":1294,"cjkReadTime":6,"description":"Artalk 的后端部署教程","content":"<p>首先，恭喜自己，成功部署了 Artalk 的后端，这或许是件很简单的事，但对于我这种对后端（利用云服务器）一窍不通的白痴来说，这还真是件值得庆祝的事，从「白痴」进阶到了「小白」。考虑到可能也有像我这样的小白，所以这篇文章就出现了。</p>\n<p>从最开始的 Valine 到 utterances 再到 Disqus。<br>\nValine 基于 LeanCloud，但是第三方的服务总归不是特别安全，LeanCloud 的政策也一直在边，完全切断免费版应该是不可能的，但限制只会越来越多。还有人发了刷 Valine 评论的教程，邮箱随时可能爆炸，本就不安全的 Valine 变得更不可靠。垃圾评论也越来越多，没有后端的 Valine 几乎没办法避免，Valine-Admin（Valine 评论系统的扩展和增强） 引入了垃圾评论过滤，但实际效果不佳，垃圾评论没过滤掉，反而正常评论被误杀了；<br>\nutterances 基于 GitHub 的 Issue，虽然官方并没有禁止使用 Issue 进行评论搭建，但是我总感觉怪怪的，而且众所周知，GitHub 的 API 在国内也非常不稳定。使用体验上，我个人觉得并不是非常好，不能进行回复，还不如直接在 Issue 界面评论；<br>\nDisqus 应该算是世界上比较有名的评论系统了，但是因为一些原因被国内墙了，国内只能依靠 DisqusJS 进行评论浏览，而如果想要评论就必须进行代理，要是没有这个问题，Disqus 或许是个很好的选择（除了那庞大的体积）。害，「向来冷清的本站雪上加霜 —— Monstx」真是麻烦啊。</p>\n<p><a href=\"https://github.com/qwqcode/Artalk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@qwqcode/Artalk</a> 🌌 一款简洁有趣的自托管评论系统，应该算是一个比较小众的评论系统了，光是要自己部署后端就劝退一大批人了。不过这都是<del>小</del>大问题，现在用的 Gridsome 框架在国内应该也算是非常小众的一款博客框架了，<del>但咱就喜欢与众不同（求异心理，不可取😜）</del>，毕竟小而美嘛，正好有台服务器，就本着试一试的心态开始了折腾。</p>\n<p>*教程采用阿里云学生机 + 宝塔面板进行演示</p>\n<div class=\"admonition admonition-warning\"><div class=\"admonition-heading\"><h5><div class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"16\" viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z\"></path></svg></div>警告</h5></div><div class=\"admonition-content\"><p><strong>鉴于最近宝塔出现的 0day 漏洞，请自行判断宝塔的安全问题！</strong></p></div></div>\n<h2 id=\"安装宝塔面板\"><a href=\"#%E5%AE%89%E8%A3%85%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>安装宝塔面板</h2>\n<p>新人建站，肯定首选宝塔。</p>\n<p>如果之前服务器有整过一些自己也不知道的东西，可以先重装一次系统（宝塔推荐使用 centos 8.X 的系统），记住重装时的用户名和密码。</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/re-install.png?fmt=webp\" alt=\"重装\"><figcaption>重装</figcaption></figure>\n<p>进入实列进行远程连接，选择 「终端连接」 进行 「密码认证」</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/remote.png?fmt=webp\" alt=\"远程连接\"><figcaption>远程连接</figcaption></figure>\n<p>输入以下命令安装宝塔</p>\n<pre class=\"language-bash line-numbers\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y <span class=\"token function\">wget</span>\n<span class=\"token function\">wget</span> -O install.sh http://download.bt.cn/install/install_6.0.sh\n<span class=\"token function\">sh</span> install.sh<span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span></span></code></pre>\n<p>安装完成后会显示登录网址（外网）和用户名密码，需要保存。同时可能会提示进行端口放行，此时前往安全组页面查看</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/safe.png?fmt=webp\" alt=\"安全组\"><figcaption>安全组</figcaption></figure>\n<p>若没有相关端口的放行则需要手动添加</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/port.png?fmt=webp\" alt=\"放行端口\"><figcaption>放行端口</figcaption></figure>\n<h2 id=\"安装相关内容\"><a href=\"#%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>安装相关内容</h2>\n<p>安装 Git，在远程连接中输入：</p>\n<pre class=\"language-bash line-numbers\"><code class=\"language-bash\">yum –y <span class=\"token function\">install</span> <span class=\"token function\">git</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span></span></code></pre>\n<p>登录宝塔界面，在软件商店页面搜索安装 <code>PHP-7.4</code> 和 <code>Nginx 1.18.0</code>，注意选择<strong>快速安装</strong></p>\n<p>进入 PHP 管理页面，在禁用函数中将 <code>putenv</code> 删除</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/putenv.png?fmt=webp\" alt=\"删除函数禁用\"><figcaption>删除函数禁用</figcaption></figure>\n<p>在远程连接中输入</p>\n<pre class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/qwqcode/ArtalkServerPhp.git\n<span class=\"token builtin class-name\">cd</span> ArtalkServerPhp\n<span class=\"token function\">composer</span> <span class=\"token function\">install</span>\nphp -r <span class=\"token string\">\"copy('Config.example.php', 'Config.php');\"</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>若在出现报错 <code>Warning: putenv() has been disabled</code>，检查禁用函数中是否还存在 <code>putenv</code>。</p>\n<h2 id=\"修改配置\"><a href=\"#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>修改配置</h2>\n<p>在宝塔面板的文件页面中找到 <code>Config.php</code> 参照注释进行修改，如果你是按之前的步骤来的，没有进入其他目录，那 <code>ArtalkServerPhp</code> 文件夹应该是在根目录的 <code>root</code> 文件夹中。</p>\n<h2 id=\"添加站点\"><a href=\"#%E6%B7%BB%E5%8A%A0%E7%AB%99%E7%82%B9\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>添加站点</h2>\n<p>更改 <code>ArtalkServePhp</code> 文件夹的权限为 755，并应用到子目录</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/authority.png?fmt=webp\" alt=\"更改权限\"><figcaption>更改权限</figcaption></figure>\n<p>在宝塔面板的站点页面添加站点，根目录选择 <code>ArtalkServePhp/public</code> 文件夹</p>\n<figure><img src=\"https://rmt.dogedoge.com/fetch/royce/storage/artalk-api-php/site.png?fmt=webp\" alt=\"添加站点\"><figcaption>添加站点</figcaption></figure>\n<p>将域名用 A 记录解析到服务器的<strong>公网 IP</strong></p>\n<p>至此，大功告成！</p>\n<h2 id=\"后\"><a href=\"#%E5%90%8E\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>后</h2>\n<p>现在发现这个过程是真的蛮简单的，不过对于当时的我来说可绝对不是这样的。这是 Artalk 后端部署的部分，前端部分如有问题可以看看「<a href=\"https://blog.monsterx.cn/code/use-self-hosted-comment-system-in-gridsome/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">为 Gridsome 添加 Artalk 自托管评论系统 - Monstx</a>」，适配了暗黑模式，那有轮子咱肯定要直接用呀！</p>\n"}}]}}},"context":{}}